var p=(n,r,e)=>new Promise((s,t)=>{var o=a=>{try{m(e.next(a))}catch(i){t(i)}},c=a=>{try{m(e.throw(a))}catch(i){t(i)}},m=a=>a.done?s(a.value):Promise.resolve(a.value).then(o,c);m((e=e.apply(n,r)).next())});var $=document.createElement("span"),g=document.createElement("input"),d=document.createElement("button"),h=document.createElement("button"),w=document.createElement("div");document.body.append($,g,d,h,w);$.textContent="Token";d.textContent="\u722C\u53D6";h.textContent="\u4E0B\u8F7D PDF";h.addEventListener("click",()=>{print()});function P(){return p(this,null,function*(){let n=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");n.searchParams.set("action","getattention"),n.searchParams.set("PKUHelperAPI","3.0"),n.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),n.searchParams.set("user_token",g.value);try{let r=yield fetch(n);if(!r.ok)return[];let{code:e,data:s}=yield r.json();if(e===0)return s}catch(r){console.error(r)}return[]})}function b(n){return p(this,null,function*(){yield new Promise(r=>setTimeout(r,1e3));for(let r=0;r<10;r++){let e=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");e.searchParams.set("action","getcomment"),e.searchParams.set("pid",n.toString()),e.searchParams.set("PKUHelperAPI","3.0"),e.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),e.searchParams.set("user_token",g.value);try{let s=yield fetch(e);if(!s.ok){alert("\u8FC7\u4E8E\u9891\u7E41"),yield new Promise(c=>setTimeout(c,3e3));continue}let{code:t,data:o}=yield s.json();if(t===0)return o;alert("\u9519\u8BEF"),yield new Promise(c=>setTimeout(c,3e3));continue}catch(s){console.error(s)}}return[]})}function k(){return p(this,null,function*(){var n,r,e,s;if(!d.classList.contains("pushing")){d.classList.add("pushing");for(let t of yield P()){let o=document.createElement("div"),c=document.createElement("div"),m=document.createElement("div");w.append(o),o.append(c);let a=Number(t.pid),i=new Date(Number(t.timestamp)*1e3);if(c.textContent=`#${a}  ${i.getFullYear()}/${i.getMonth()+1}/${i.getDate()} ${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}  ${t.likenum} \u6536\u85CF  ${t.reply} \u56DE\u590D  ${(n=t.tag)!=null?n:""}
${(r=t.text)!=null?r:""}`,t.type==="image"&&typeof t.url=="string"){let u=document.createElement("img");o.append(u),a>3218523?u.src=`https://pkuhelper.pku.edu.cn/services/pkuhole/images/${t.url}`:u.src=`https://ewr1.vultrobjects.com/ph-static/images/${t.url}`}o.append(m);for(let u of yield b(a)){let f=document.createElement("div");m.append(f);let l=new Date(Number(u.timestamp)*1e3);f.textContent=`#${u.cid}  ${l.getFullYear()}/${l.getMonth()+1}/${l.getDate()} ${l.getHours()}:${l.getMinutes()}:${l.getSeconds()}  ${(e=u.tag)!=null?e:""}
${(s=u.text)!=null?s:""}`}}d.classList.remove("pushing")}})}g.addEventListener("keydown",n=>p(void 0,null,function*(){n.key==="Enter"&&(yield k())}));d.addEventListener("click",k);
