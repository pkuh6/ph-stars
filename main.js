var l=(n,e,r)=>new Promise((i,t)=>{var u=a=>{try{d(r.next(a))}catch(s){t(s)}},m=a=>{try{d(r.throw(a))}catch(s){t(s)}},d=a=>a.done?i(a.value):Promise.resolve(a.value).then(u,m);d((r=r.apply(n,e)).next())});var p=document.createElement("input"),g=document.createElement("button"),f=document.createElement("div");document.body.append("Token",p,g,f);g.textContent="\u722C\u53D6";function k(){return l(this,null,function*(){let n=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");n.searchParams.set("action","getattention"),n.searchParams.set("PKUHelperAPI","3.0"),n.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),n.searchParams.set("user_token",p.value);try{let e=yield fetch(n);if(!e.ok)return[];let{code:r,data:i}=yield e.json();if(r===0)return i}catch(e){console.error(e)}return[]})}function w(n){return l(this,null,function*(){let e=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");e.searchParams.set("action","getcomment"),e.searchParams.set("pid",n.toString()),e.searchParams.set("PKUHelperAPI","3.0"),e.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),e.searchParams.set("user_token",p.value);try{let r=yield fetch(e);if(!r.ok)return[];let{code:i,data:t}=yield r.json();if(i===0)return t}catch(r){console.error(r)}return[]})}function $(){return l(this,null,function*(){var n,e,r,i;for(let t of yield k()){let u=document.createElement("div"),m=document.createElement("div"),d=document.createElement("div");f.append(u),u.append(m,d);let a=Number(t.pid),s=new Date(Number(t.timestamp)*1e3);if(m.textContent=`#${a}  ${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()} ${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}  ${t.likenum} \u6536\u85CF  ${t.reply} \u56DE\u590D  ${(n=t.tag)!=null?n:""}
${(e=t.text)!=null?e:""}`,t.type==="image"&&typeof t.url=="string"){let o=document.createElement("img");u.append(o),a>3218523?o.src=`https://pkuhelper.pku.edu.cn/services/pkuhole/images/${t.url}`:o.src=`https://ewr1.vultrobjects.com/ph-static/images/${t.url}`}yield new Promise(o=>setTimeout(o,1e3));for(let o of yield w(a)){let h=document.createElement("div");m.append(h);let c=new Date(Number(o.timestamp)*1e3);h.textContent=`#${o.cid}  ${c.getFullYear()}/${c.getMonth()+1}/${c.getDate()} ${c.getHours()}:${c.getMinutes()}:${c.getSeconds()}  ${(r=o.tag)!=null?r:""}
${(i=o.text)!=null?i:""}`}}})}p.addEventListener("keydown",n=>l(void 0,null,function*(){n.key==="Enter"&&(yield $())}));g.addEventListener("click",$);
