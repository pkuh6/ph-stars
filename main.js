var d=(t,e,n)=>new Promise((s,r)=>{var o=a=>{try{m(n.next(a))}catch(i){r(i)}},c=a=>{try{m(n.throw(a))}catch(i){r(i)}},m=a=>a.done?s(a.value):Promise.resolve(a.value).then(o,c);m((n=n.apply(t,e)).next())});var w=document.createElement("span"),g=document.createElement("input"),p=document.createElement("button"),f=document.createElement("button"),h=document.createElement("div");document.body.append(w,g,p,f,h);w.textContent="Token";p.textContent="\u722C\u53D6";f.textContent="\u4E0B\u8F7D PDF";f.addEventListener("click",()=>{print()});function k(){return d(this,null,function*(){let t=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");t.searchParams.set("action","getattention"),t.searchParams.set("PKUHelperAPI","3.0"),t.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),t.searchParams.set("user_token",g.value);try{let e=yield fetch(t);if(!e.ok)return[];let{code:n,data:s}=yield e.json();if(n===0)return s}catch(e){console.error(e)}return[]})}function P(t){return d(this,null,function*(){yield new Promise(e=>setTimeout(e,500));for(let e=0;e<10;e++){let n=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");n.searchParams.set("action","getcomment"),n.searchParams.set("pid",t.toString()),n.searchParams.set("PKUHelperAPI","3.0"),n.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),n.searchParams.set("user_token",g.value);try{let s=yield fetch(n);if(!s.ok){alert("\u8FC7\u4E8E\u9891\u7E41"),yield new Promise(c=>setTimeout(c,1e3));continue}let{code:r,data:o}=yield s.json();if(r===0)return o;alert("\u9519\u8BEF"),yield new Promise(c=>setTimeout(c,1e3));continue}catch(s){console.error(s)}}return[]})}function v(t){return d(this,null,function*(){let e=yield P(t);return e.length>1&&Number(e[0].cid)>Number(e[1].cid)&&e.reverse(),e})}function b(){return d(this,null,function*(){var t,e,n,s;if(!p.classList.contains("pushing")){p.classList.add("pushing"),h.innerHTML="";for(let r of yield k()){let o=document.createElement("div"),c=document.createElement("div"),m=document.createElement("div");h.append(o),o.append(c);let a=Number(r.pid),i=new Date(Number(r.timestamp)*1e3);if(c.textContent=`#${a}  ${i.getFullYear()}/${i.getMonth()+1}/${i.getDate()} ${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}  ${r.likenum} \u6536\u85CF  ${r.reply} \u56DE\u590D  ${(t=r.tag)!=null?t:""}
${(e=r.text)!=null?e:""}`,r.type==="image"&&typeof r.url=="string"){let u=document.createElement("img");o.append(u),a>3218523?u.src=`https://pkuhelper.pku.edu.cn/services/pkuhole/images/${r.url}`:u.src=`https://ewr1.vultrobjects.com/ph-static/images/${r.url}`}o.append(m);for(let u of yield v(a)){let $=document.createElement("div");m.append($);let l=new Date(Number(u.timestamp)*1e3);$.textContent=`#${u.cid}  ${l.getFullYear()}/${l.getMonth()+1}/${l.getDate()} ${l.getHours()}:${l.getMinutes()}:${l.getSeconds()}  ${(n=u.tag)!=null?n:""}
${(s=u.text)!=null?s:""}`}}alert("\u5B8C\u6210"),p.classList.remove("pushing")}})}g.addEventListener("keydown",t=>d(void 0,null,function*(){t.key==="Enter"&&(yield b())}));p.addEventListener("click",b);
