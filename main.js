var l=(n,e,r)=>new Promise((i,t)=>{var c=s=>{try{u(r.next(s))}catch(a){t(a)}},p=s=>{try{u(r.throw(s))}catch(a){t(a)}},u=s=>s.done?i(s.value):Promise.resolve(s.value).then(c,p);u((r=r.apply(n,e)).next())});var $=document.createElement("span"),g=document.createElement("input"),d=document.createElement("button"),h=document.createElement("button"),k=document.createElement("div");document.body.append($,g,d,h,k);$.textContent="Token";d.textContent="\u722C\u53D6";h.textContent="\u4E0B\u8F7D PDF";h.addEventListener("click",()=>{print()});function v(){return l(this,null,function*(){let n=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");n.searchParams.set("action","getattention"),n.searchParams.set("PKUHelperAPI","3.0"),n.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),n.searchParams.set("user_token",g.value);try{let e=yield fetch(n);if(!e.ok)return[];let{code:r,data:i}=yield e.json();if(r===0)return i}catch(e){console.error(e)}return[]})}function w(n){return l(this,null,function*(){let e=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");e.searchParams.set("action","getcomment"),e.searchParams.set("pid",n.toString()),e.searchParams.set("PKUHelperAPI","3.0"),e.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),e.searchParams.set("user_token",g.value);try{let r=yield fetch(e);if(!r.ok)return[];let{code:i,data:t}=yield r.json();if(i===0)return t}catch(r){console.error(r)}return[]})}function b(){return l(this,null,function*(){var n,e,r,i;if(!d.classList.contains("pushing")){d.classList.add("pushing");for(let t of yield v()){let c=document.createElement("div"),p=document.createElement("div"),u=document.createElement("div");k.append(c),c.append(p);let s=Number(t.pid),a=new Date(Number(t.timestamp)*1e3);if(p.textContent=`#${s}  ${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()} ${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}  ${t.likenum} \u6536\u85CF  ${t.reply} \u56DE\u590D  ${(n=t.tag)!=null?n:""}
${(e=t.text)!=null?e:""}`,t.type==="image"&&typeof t.url=="string"){let o=document.createElement("img");c.append(o),s>3218523?o.src=`https://pkuhelper.pku.edu.cn/services/pkuhole/images/${t.url}`:o.src=`https://ewr1.vultrobjects.com/ph-static/images/${t.url}`}c.append(u),yield new Promise(o=>setTimeout(o,1e3));for(let o of yield w(s)){let f=document.createElement("div");u.append(f);let m=new Date(Number(o.timestamp)*1e3);f.textContent=`#${o.cid}  ${m.getFullYear()}/${m.getMonth()+1}/${m.getDate()} ${m.getHours()}:${m.getMinutes()}:${m.getSeconds()}  ${(r=o.tag)!=null?r:""}
${(i=o.text)!=null?i:""}`}}d.classList.remove("pushing")}})}g.addEventListener("keydown",n=>l(void 0,null,function*(){n.key==="Enter"&&(yield b())}));d.addEventListener("click",b);
