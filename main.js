var l=(n,e,r)=>new Promise((o,t)=>{var d=s=>{try{c(r.next(s))}catch(a){t(a)}},p=s=>{try{c(r.throw(s))}catch(a){t(a)}},c=s=>s.done?o(s.value):Promise.resolve(s.value).then(d,p);c((r=r.apply(n,e)).next())});var g=document.createElement("input"),m=document.createElement("button"),f=document.createElement("div");document.body.append("Token",g,m,f);m.textContent="\u722C\u53D6";function k(){return l(this,null,function*(){let n=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");n.searchParams.set("action","getattention"),n.searchParams.set("PKUHelperAPI","3.0"),n.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),n.searchParams.set("user_token",g.value);try{let e=yield fetch(n);if(!e.ok)return[];let{code:r,data:o}=yield e.json();if(r===0)return o}catch(e){console.error(e)}return[]})}function w(n){return l(this,null,function*(){let e=new URL("https://pkuhelper.pku.edu.cn/services/pkuhole/api.php");e.searchParams.set("action","getcomment"),e.searchParams.set("pid",n.toString()),e.searchParams.set("PKUHelperAPI","3.0"),e.searchParams.set("jsapiver",`201027113050-${2*Math.floor(Date.now()/72e5)}`),e.searchParams.set("user_token",g.value);try{let r=yield fetch(e);if(!r.ok)return[];let{code:o,data:t}=yield r.json();if(o===0)return t}catch(r){console.error(r)}return[]})}function $(){return l(this,null,function*(){var n,e,r,o;if(!m.classList.contains("pushing")){m.classList.add("pushing");for(let t of yield k()){let d=document.createElement("div"),p=document.createElement("div"),c=document.createElement("div");f.append(d),d.append(p,c);let s=Number(t.pid),a=new Date(Number(t.timestamp)*1e3);if(p.textContent=`#${s}  ${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()} ${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}  ${t.likenum} \u6536\u85CF  ${t.reply} \u56DE\u590D  ${(n=t.tag)!=null?n:""}
${(e=t.text)!=null?e:""}`,t.type==="image"&&typeof t.url=="string"){let i=document.createElement("img");d.append(i),s>3218523?i.src=`https://pkuhelper.pku.edu.cn/services/pkuhole/images/${t.url}`:i.src=`https://ewr1.vultrobjects.com/ph-static/images/${t.url}`}yield new Promise(i=>setTimeout(i,1e3));for(let i of yield w(s)){let h=document.createElement("div");c.append(h);let u=new Date(Number(i.timestamp)*1e3);h.textContent=`#${i.cid}  ${u.getFullYear()}/${u.getMonth()+1}/${u.getDate()} ${u.getHours()}:${u.getMinutes()}:${u.getSeconds()}  ${(r=i.tag)!=null?r:""}
${(o=i.text)!=null?o:""}`}}m.classList.remove("pushing")}})}g.addEventListener("keydown",n=>l(void 0,null,function*(){n.key==="Enter"&&(yield $())}));m.addEventListener("click",$);
